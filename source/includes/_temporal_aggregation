# Temporal Aggregation

## `GET v1/api/timeseries`

> ### Example Query

```
http://plenar.io/v1/api/timeseries/?obs_date__ge=2010-1-1&
obs_date__le=2015-12-31&dataset_name__in=crimes_2001_to_present,
cdph_environmental_complaints&agg=year
```

> Count of crime and environmental complaints per year from 2010 to 2015.

> ### Example Response

```json
{
    "meta": {
        "status": "ok",
        "query": {
            "obs_date__ge": "2007-11-12",
            "data_type": "json",
            "obs_date__le": "2008-11-12",
            "agg": "year",
            "dataset": null,
            "dataset_name__in": [
                "crimes_2001_to_present",
                "cdph_environmental_complaints"
            ],
            "geom": null
        },
        "message": [ ]
    },
    "objects": [
        {
            "attribution": "Chicago Department of Public Health",
            "description": "Environmental complaints received by the Department of Environment (DOE) from January 1993 to December 31, 2011 and by the Department of Public Health (CDPH) since January 1, 2012. On January 1, 2012, the DOE was disbanded and all its inspection, permitting, and enforcement authorities were transferred to the CDPH.",
            "view_url": "http://data.cityofchicago.org/api/views/fypr-ksnz/rows",
            "source_url": "http://data.cityofchicago.org/api/views/fypr-ksnz/rows.csv?accessType=DOWNLOAD",
            "bbox": {
                "type": "Polygon",
                "coordinates": [...]
            },
            "obs_from": "1993-01-04",
            "date_added": "2014-09-10 17:09:39.684758",
            "contributor_email": null,
            "contributor_organization": null,
            "count": 1447,
            "contributor_name": null,
            "items": [...],
            "last_update": "2016-07-01T08:18:19.783959",
            "obs_to": "2016-06-28",
            "human_name": "Environmental Complaints",
            "dataset_name": "cdph_environmental_complaints",
            "update_freq": "daily"
        },
        {
            "attribution": "Chicago Police Department",
            "description": "This dataset reflects reported incidents of crime (with the exception of murders where data exists for each victim) that occurred in the City of Chicago from 2001 to present, minus the most recent seven days. ",
            "view_url": "http://data.cityofchicago.org/api/views/ijzp-q8t2/rows",
            "source_url": "http://data.cityofchicago.org/api/views/ijzp-q8t2/rows.csv?accessType=DOWNLOAD",
            "bbox": {
                "type": "Polygon",
                "coordinates": [...]
            },
            "obs_from": "2001-01-01",
            "date_added": "2014-09-10 22:51:19.214726",
            "contributor_email": null,
            "contributor_organization": null,
            "count": 429324,
            "contributor_name": null,
            "items": [...],
            "last_update": "2016-07-01T09:11:15.178044",
            "obs_to": "2016-06-22",
            "human_name": "Crimes - 2001 to present",
            "dataset_name": "crimes_2001_to_present",
            "update_freq": "daily"
        }
    ]
}
```

This endpoint creates timeseries over one or more event datasets.



### Query Parameters

All query parameters are optional.

| **Parameter Name**       | **Parameter Default** | **Parameter Description**                                                                                                                                                                                                                                          |
|----------------------|-------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **agg**                  | week              | Time resolution to aggregate observation counts by. Supported values: <ul><li>day</li><li>week</li><li>month</li><li>quarter</li><li>year</li></ul>                                                                                                                                                   |
| **obs_date__ge**         | 90 days ago       | Obversations greater than or equal to a given date.  Dates must be formatted as **YYYY-MM-DD**                                                                                                                                                                     |
| **obs_date__le**         | today's date      | Observations less than or equal to a given date.  Dates must be formatted as **YYYY-MM-DD**                                                                                                                                                                        |
| **dataset_name**         | none              | Machine version of the dataset name as you get it from the `/v1/api/datasets` endpoint. If not provided, returns all available datasets. More than one dataset can be requested by using `dataset_name__in` and listing multiple comma separated dataset names. |
| **location_geom_within** | none              | A URL encoded [GeoJSON](http://geojson.org/) polygon representing the area of interest                                                                                                                                                                         |
| **data_type**            | json              | Response data format. Current options are `json`, `geojson`, and `csv`.
| **[dataset]__filter** | none  | See [advanced filtering](#advanced-filtering) for more info.

<aside class=notice>To make a multifaceted query, combine additional parameters using an ampersand (&)</aside>

### Response

The API responds with a list of datasets with a dense matrix of counts grouped
by temporal aggregation.

| **Attribute Name** | **Attribute Description**                              |
| ------------------ | ------------------------------------------------------ |
| **_meta_**         |                                                        |
| **status**         | Indicates query success, can be `ok` or `error`.       |
| **query**          | Shows values used in the query.                        |
| **message**        | Reports errors or warnings (if any).                   |
| **_objects_**      |                                                        |
| **bbox**           | Spacial bounds that contain all the records.           |
| **count**          | Total number of records found within obs_date bounds.  |
| **dataset_name**   | Machine version of a specific dataset name.            |
| **items**          | Counts of aggregated records and delimiting datetimes. |
| **update_freq**    | Frequency with records are refreshed and updated.      |

<aside class=notice>The ellipses in place of <i>coordinates</i> values replace
GeoJSON longitude and latitude; those in place of <i>items</i> replace
formatted JSON data for crimes and complaints, aggregated by week.</aside>
